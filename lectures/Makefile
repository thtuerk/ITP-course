.PHONY: full full-print current current-print all_parts all_parts_print all clean cleanAll all-slides all-print all_parts-all full-all default

default : all

PARTS = $(wildcard itp_parts_*.tex)

current: version.inc
	@./mk_slides.sh current current

full: version.inc
	@./mk_slides.sh full itp-course

full-print: version.inc
	@./mk_handout.sh full itp-course-print

full-all: version.inc 
	@./mk_slides.sh full itp-course
	@./mk_handout.sh full itp-course-print

hol: version.inc
	@./mk_slides.sh hol hol-course

hol-print: version.inc
	@./mk_handout.sh hol hol-course-print

hol-all: version.inc 
	@./mk_slides.sh hol hol-course
	@./mk_handout.sh hol hol-course-print


current-print: version.inc
	@./mk_handout.sh current current-print

itp_parts_%: version.inc
	@./mk_slides.sh $@ $@

itp_parts_%-print: version.inc
	@./mk_handout.sh $(patsubst %-print,%,$@) $@

itp_parts_%-all: version.inc
	@./mk_slides.sh $(patsubst %-all,%,$@) $(patsubst %-all,%,$@)
	@./mk_handout.sh $(patsubst %-all,%,$@) $(patsubst %-all,%-print,$@)

all_parts : $(PARTS:.tex=)
all_parts-print : $(PARTS:.tex=-print)
all_parts-all : $(PARTS:.tex=-all)

all-slides: version.inc full hol all_parts
all-print: version.inc hol-print full-print all_parts-print

all: full-all hol-all all_parts-all

clean:
	rm -rf *.ps *.pdf *~ *.dvi *.aux *.log *.idx *.toc *.nav *.out *.snm *.flc *.vrb version.inc tmp

cleanAll: clean
	rm -rf pdfs 

version.inc: ../.git/logs/HEAD
	@echo "%%% This file is generated by Makefile." > version.inc
	@echo "%%% Do not edit this file!\n%%%" >> version.inc
	@git log -1 --date=local --format="format:\
		\\gdef\\GITAbrHash{%h}\
		\\gdef\\GITAuthorDate{%ad}\
		\\gdef\\GITAuthorName{%an}" >> version.inc
